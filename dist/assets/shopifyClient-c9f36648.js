import{R as J}from"./index-1606e3a6.js";function W(...e){for(const o of e){const r=(o??"").toString().trim();if(r)return r}return""}var k,x,D,G;const f={fromEnv:((x=(k=import.meta)==null?void 0:k.env)==null?void 0:x.VITE_SHOPIFY_API_BASE)??"",fromRuntime:((D=J)==null?void 0:D.SHOPIFY_API_BASE)??"",fromWindow:typeof window<"u"?((G=window.__APP_CONFIG__)==null?void 0:G.SHOPIFY_API_BASE)??"":""};let p=W(f.fromEnv,f.fromRuntime,f.fromWindow);p||(p="http://192.168.1.137:5000/api/shopify");p=p.replace(/\/$/,"");console.info("[Shopify FE] API_BASE sources:",f);console.info("[Shopify FE] API_BASE resolved →",p);function V(e){var h,g,S,E,C;const o=t=>String(t||"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g,"").replace("colour","color").replace("talla","size").replace("tamano","size").replace("tamaño","size"),r=t=>t==null?null:typeof t=="number"?t:typeof t=="object"&&t.amount!=null?Number(t.amount):Number(t),n=(e==null?void 0:e.imageUrl)||(e==null?void 0:e.image)||((h=e==null?void 0:e.featuredImage)==null?void 0:h.url)||Array.isArray(e==null?void 0:e.images)&&((g=e.images[0])==null?void 0:g.url)||null;console.log("[DBG] raw.options:",e==null?void 0:e.options);const a=((e==null?void 0:e.options)||[]).map(t=>{console.log("[DBG] opt.name:",t==null?void 0:t.name,"opt.values:",t==null?void 0:t.values,"type:",typeof(t==null?void 0:t.values));let u=(t==null?void 0:t.values)||[];return typeof u=="string"&&(u=u.split(",").map(y=>y.trim()).filter(Boolean)),{name:(t==null?void 0:t.name)??"",key:o(t==null?void 0:t.name),values:Array.from(new Set(u.map(String)))}}),i=((e==null?void 0:e.variants)||[]).map(t=>{var F,A,P,N,I,O,_,b,R,T,U,M,z,B;const u=r(((F=t==null?void 0:t.price)==null?void 0:F.amount)??(t==null?void 0:t.price)),y=((A=t==null?void 0:t.price)==null?void 0:A.currencyCode)??((I=(N=(P=t==null?void 0:t.presentmentPrices)==null?void 0:P[0])==null?void 0:N.price)==null?void 0:I.currencyCode)??((_=(O=e==null?void 0:e.priceRangeV2)==null?void 0:O.minVariantPrice)==null?void 0:_.currencyCode)??"USD",j=((b=t==null?void 0:t.image)==null?void 0:b.src)||((R=t==null?void 0:t.image)==null?void 0:R.url)||((U=(T=e==null?void 0:e.images)==null?void 0:T[0])==null?void 0:U.src)||((M=e==null?void 0:e.featuredImage)==null?void 0:M.url)||null;e!=null&&e.variants&&e.variants[0]&&e.variants[0].selectedOptions&&console.log("[DBG] v0.selectedOptions:",(B=(z=e==null?void 0:e.variants)==null?void 0:z[0])==null?void 0:B.selectedOptions);const q=((t==null?void 0:t.selectedOptions)||[]).map(l=>{const Y=(l==null?void 0:l.name)??"",H=o(l==null?void 0:l.name);let m=(l==null?void 0:l.value)??"";return H==="size"&&typeof m=="string"&&m.includes(",")&&(m=""),{name:Y,key:H,value:m}});return{id:t==null?void 0:t.id,price:u,currencyCode:y,available:(t==null?void 0:t.availableForSale)??(t==null?void 0:t.available)??!0,quantityAvailable:(t==null?void 0:t.quantityAvailable)??null,imageUrl:j,selectedOptions:q}}),s=Array.from(new Set(i.flatMap(t=>t.selectedOptions.map(u=>u.key)))),c=a.filter(t=>s.includes(t.key)),d=i.map(t=>t.price).filter(t=>typeof t=="number"&&!Number.isNaN(t)),$=d.length?Math.min(...d):null,L=d.length?Math.max(...d):null;return{id:e==null?void 0:e.id,title:e==null?void 0:e.title,handle:e==null?void 0:e.handle,description:(e==null?void 0:e.description)||(e==null?void 0:e.descriptionHtml)||"",imageUrl:n,options:c,variants:i,currencyCode:((E=(S=e==null?void 0:e.priceRangeV2)==null?void 0:S.minVariantPrice)==null?void 0:E.currencyCode)??((C=i==null?void 0:i[0])==null?void 0:C.currencyCode)??"USD",priceMin:$,priceMax:L}}function K(e){return(Array.isArray(e)?e:Array.isArray(e==null?void 0:e.products)?e.products:[]).map(V)}async function X(){var a,i;const e=`${p}/products`;console.info("[Shopify FE Client] Fetching products from:",e);let o;try{o=await fetch(e,{method:"GET"}),console.log("[Shopify FE Client] Response status:",o.status,o.statusText)}catch(s){return console.error("[Shopify FE Client] ❌ Network error:",(s==null?void 0:s.message)||s),console.error("[Shopify FE Client] Could not connect to backend. Is the server running?"),[]}if(!o.ok){const s=await o.text().catch(()=>"");return console.error("[Shopify FE Client] ❌ HTTP",o.status,"→",s.slice(0,300)),[]}let r;try{r=await o.json(),console.log("[Shopify FE Client] Raw response type:",Array.isArray(r)?"array":typeof r),console.log("[Shopify FE Client] Raw response count:",Array.isArray(r)?r.length:"N/A")}catch{const s=await o.text().catch(()=>"");return console.error("[Shopify FE Client] ❌ Non-JSON response:",s.slice(0,300)),[]}const n=K(r);return console.info("[Shopify FE Client] ✅ Normalized",n.length,"products"),n[0]?console.debug("[Shopify FE Client] First normalized product:",{title:n[0].title,priceMin:n[0].priceMin,priceMax:n[0].priceMax,currency:n[0].currencyCode,imageUrl:n[0].imageUrl?"✓ presente":"✗ ausente",options:n[0].options,variantCount:((a=n[0].variants)==null?void 0:a.length)||0,sampleVariant:(i=n[0].variants)!=null&&i[0]?{id:n[0].variants[0].id,price:n[0].variants[0].price,available:n[0].variants[0].available}:"sin variantes"}):console.warn("[Shopify FE Client] ⚠️ No products to display"),n}async function Z(e){var s;const o=(e||"").toString().trim().toLowerCase();if(!o)throw console.error("[Shopify FE] Handle vacío"),new Error("Handle de producto requerido");const r=`${p}/products/${encodeURIComponent(o)}`;console.info("[Shopify FE Client] Fetching product by handle:",o),console.info("[Shopify FE Client] URL:",r);let n;try{n=await fetch(r,{method:"GET",credentials:"include"}),console.log("[Shopify FE Client] Response status:",n.status,n.statusText)}catch(c){throw console.error("[Shopify FE Client] ❌ Network error:",(c==null?void 0:c.message)||c),new Error("Error de conexión al obtener producto")}if(n.status===404)throw console.warn("[Shopify FE Client] ⚠️ Producto no encontrado:",o),new Error("PRODUCT_NOT_FOUND");if(!n.ok){const c=await n.text().catch(()=>"");throw console.error("[Shopify FE Client] ❌ HTTP",n.status,"→",c.slice(0,300)),new Error(`Error HTTP ${n.status}`)}let a;try{a=await n.json(),console.log("[Shopify FE Client] Product data received:",a.title)}catch{const c=await n.text().catch(()=>"");throw console.error("[Shopify FE Client] ❌ Non-JSON response:",c.slice(0,300)),new Error("Respuesta inválida del servidor")}const i=V(a);return console.info("[Shopify FE Client] ✅ Product normalized:",{title:i.title,priceMin:i.priceMin,variantCount:((s=i.variants)==null?void 0:s.length)||0,imageUrl:i.imageUrl?"✓":"✗"}),i}export{Z as g,X as l};
