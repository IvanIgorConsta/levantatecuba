import{c as I,u as _,m as G,l as H,r as n,j as e,X as J,n as W,V as p}from"./index-1606e3a6.js";import{p as P}from"./purify.es-ee0e7e34.js";import{B as A}from"./BackLink-10c487b2.js";import{S as M}from"./shield-226a05e9.js";import{U as O,C as $}from"./user-320d65d9.js";import{E as Q,F as K,P as X,I as Y}from"./paperclip-7f3f2cde.js";import{E as Z}from"./eye-311343d1.js";import{L as ee}from"./loader-circle-de7850c1.js";/**
 * @license lucide-react v0.519.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]],te=I("cloud-upload",se);/**
 * @license lucide-react v0.519.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=[["path",{d:"M4 22h14a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v4",key:"1pf5j1"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["rect",{width:"8",height:"6",x:"2",y:"12",rx:"1",key:"1a6c1e"}],["path",{d:"m10 15.5 4 2.5v-6l-4 2.5",key:"t7cp39"}]],ne=I("file-video-2",ae);function ue(){_(),G();const m=H(),z=n.useRef(null),U=n.useRef(null),[h,E]=n.useState(!1),[r,f]=n.useState([]),[g,k]=n.useState(""),[D,S]=n.useState(""),[c,L]=n.useState(!1),[b,v]=n.useState(!1),[j,l]=n.useState(""),[T,N]=n.useState({contenido:!1}),x=g.trim().length,d=x>=10,w=T.contenido&&!d,F=localStorage.getItem("token"),R=!!F;n.useEffect(()=>()=>{r.forEach(s=>{s.preview&&URL.revokeObjectURL(s.preview)})},[r]);const y=s=>{s.preventDefault(),s.stopPropagation(),s.type==="dragenter"||s.type==="dragover"?v(!0):s.type==="dragleave"&&v(!1)},q=s=>{s.preventDefault(),s.stopPropagation(),v(!1),s.dataTransfer.files&&s.dataTransfer.files.length>0&&C(Array.from(s.dataTransfer.files))},C=s=>{if(l(""),r.length+s.length>5){l("❌ Máximo 5 archivos permitidos por denuncia");return}const t=["image/jpeg","image/jpg","image/png","image/gif","image/webp","video/mp4","video/webm","video/quicktime"],i=[];for(const a of s){if(!t.includes(a.type)){l(`❌ "${a.name}" - Tipo no permitido. Solo imágenes y videos.`);continue}if(a.size>15*1024*1024){l(`❌ "${a.name}" supera el límite de 15MB.`);continue}const o={file:a,preview:URL.createObjectURL(a),type:a.type.startsWith("image/")?"image":"video",name:a.name,size:(a.size/(1024*1024)).toFixed(2)};i.push(o)}i.length>0&&f(a=>[...a,...i])},V=s=>{f(t=>{const i=[...t];return i[s].preview&&URL.revokeObjectURL(i[s].preview),i.splice(s,1),i}),l("")},B=async s=>{var a;if(s.preventDefault(),N({contenido:!0}),!R){p.error("❌ Debes iniciar sesión para hacer una denuncia."),setTimeout(()=>{m("/login?redirect=/romper")},1500);return}if(!d){p.error("❌ Describe tu denuncia con al menos 10 caracteres.");return}const t=new FormData,i=c?"":P.sanitize(D.trim());t.set("nombre",i),t.set("contenido",P.sanitize(g.trim())),r.forEach(o=>{t.append("files",o.file)});try{E(!0);const o=await fetch("/api/reports",{method:"POST",headers:{Authorization:`Bearer ${F}`},body:t});if(!o.ok){const u=await o.json().catch(()=>({error:"Error desconocido"}));throw new Error(u.error||"Error al enviar denuncia")}(a=z.current)==null||a.reset(),r.forEach(u=>{u.preview&&URL.revokeObjectURL(u.preview)}),f([]),k(""),S(""),L(!1),N({contenido:!1}),p.success("✅ Tu denuncia fue enviada correctamente. Será revisada pronto."),setTimeout(()=>{m("/denuncias")},2e3)}catch(o){console.error(o),p.error(o.message||"❌ Hubo un error al enviar la denuncia. Intenta de nuevo.")}finally{E(!1)}};return R?e.jsx("main",{className:"min-h-screen bg-transparent px-4 py-10 md:px-8",children:e.jsxs("div",{className:"mx-auto max-w-3xl",children:[e.jsx(A,{to:"/",label:"Volver al inicio"}),e.jsxs("header",{className:"mb-8 text-center",children:[e.jsx("h1",{className:"mt-3 bg-gradient-to-r from-red-500 via-red-400 to-rose-400 bg-clip-text text-3xl font-extrabold text-transparent md:text-4xl",children:"Haz tu denuncia ciudadana"}),e.jsx("p",{className:"mx-auto mt-3 max-w-2xl text-sm text-zinc-400",children:"Tu voz importa. Reporta situaciones irregulares de forma segura y anónima si lo deseas."})]}),e.jsx("section",{className:"rounded-2xl border border-zinc-800 bg-zinc-900/50 p-6 md:p-8 shadow-xl",children:e.jsxs("form",{id:"form-report",ref:z,className:"space-y-6",onSubmit:B,noValidate:!0,children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-lg font-semibold text-white",children:[e.jsx(O,{className:"w-5 h-5"}),"Identificación"]}),e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-lg border border-zinc-800 bg-zinc-900/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[c?e.jsx(Q,{className:"w-5 h-5 text-zinc-400"}):e.jsx(Z,{className:"w-5 h-5 text-zinc-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-white",children:c?"Denuncia Anónima":"Denuncia con Nombre"}),e.jsx("p",{className:"text-xs text-zinc-500",children:c?"Tu identidad permanecerá oculta":"Tu nombre será visible en la denuncia"})]})]}),e.jsx("button",{type:"button",onClick:()=>L(!c),className:`relative w-12 h-6 rounded-full transition ${c?"bg-red-500":"bg-zinc-700"}`,children:e.jsx("span",{className:`absolute top-1 left-1 w-4 h-4 bg-white rounded-full transition-transform ${c?"translate-x-6":"translate-x-0"}`})})]}),!c&&e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{htmlFor:"nombre",className:"text-sm font-medium text-white",children:"Tu nombre"}),e.jsx("input",{id:"nombre",name:"nombre",type:"text",placeholder:"Ej: Juan Pérez",value:D,onChange:s=>S(s.target.value),className:"w-full rounded-lg border border-zinc-800 bg-zinc-900 px-4 py-3 text-white placeholder-zinc-500 outline-none transition focus:border-red-500 focus:ring-1 focus:ring-red-500"}),e.jsx("p",{className:"text-xs text-zinc-500",children:"Este nombre aparecerá públicamente en tu denuncia"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{htmlFor:"contenido",className:"flex items-center gap-2 text-sm font-medium text-white",children:[e.jsx(K,{className:"w-4 h-4"}),"Descripción detallada",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsxs("span",{className:`text-xs ${x===0?"text-zinc-500":d?"text-green-400":"text-yellow-400"}`,children:[x," caracteres ",x<10&&"(mínimo 10)"]})]}),e.jsx("textarea",{id:"contenido",name:"contenido",placeholder:"Describe detalladamente la situación: ¿Qué sucedió? ¿Dónde? ¿Cuándo? ¿Quiénes están involucrados? Incluye todos los detalles relevantes...",required:!0,minLength:10,value:g,onChange:s=>k(s.target.value),onBlur:()=>N({...T,contenido:!0}),rows:8,className:`w-full resize-y rounded-lg border bg-zinc-900 px-4 py-3 text-white placeholder-zinc-500 outline-none transition ${w?"border-red-500 focus:border-red-500 focus:ring-1 focus:ring-red-500":"border-zinc-800 focus:border-red-500 focus:ring-1 focus:ring-red-500"}`,"aria-invalid":w,"aria-describedby":"contenido-help"}),w&&e.jsxs("p",{className:"flex items-center gap-1 text-xs text-red-400",children:[e.jsx($,{className:"w-3 h-3"}),"La descripción debe tener al menos 10 caracteres"]}),e.jsx("p",{id:"contenido-help",className:"text-xs text-zinc-500",children:"Sé específico y objetivo. No incluyas información personal sensible que no desees hacer pública."})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-white",children:[e.jsx(X,{className:"w-4 h-4"}),"Evidencia multimedia (opcional)"]}),e.jsxs("span",{className:"text-xs text-zinc-500",children:[r.length,"/5 archivos"]})]}),r.length>0&&e.jsx("div",{className:"space-y-2 mb-3",children:r.map((s,t)=>e.jsxs("div",{className:"p-3 rounded-lg bg-zinc-900 border border-zinc-800",children:[s.type==="image"&&e.jsx("div",{className:"mb-2 rounded-lg overflow-hidden bg-zinc-800",children:e.jsx("img",{src:s.preview,alt:`Vista previa ${t+1}`,className:"w-full h-32 object-cover"})}),s.type==="video"&&e.jsx("div",{className:"mb-2 rounded-lg overflow-hidden bg-zinc-800",children:e.jsx("video",{src:s.preview,className:"w-full h-32",muted:!0})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[s.type==="video"?e.jsx(ne,{className:"w-4 h-4 text-zinc-400 flex-shrink-0"}):e.jsx(Y,{className:"w-4 h-4 text-zinc-400 flex-shrink-0"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-xs text-white truncate",children:s.name}),e.jsxs("p",{className:"text-xs text-zinc-500",children:[s.size," MB"]})]})]}),e.jsx("button",{type:"button",onClick:()=>V(t),className:"p-1 text-zinc-400 hover:text-red-400 transition",title:"Eliminar archivo",children:e.jsx(J,{className:"w-4 h-4"})})]})]},t))}),r.length<5&&e.jsxs("div",{className:`relative rounded-xl border-2 border-dashed transition-all ${b?"border-red-500 bg-red-500/10":j?"border-red-500/50 bg-red-500/5":"border-zinc-800 bg-zinc-900/50 hover:border-zinc-700"}`,onDragEnter:y,onDragLeave:y,onDragOver:y,onDrop:q,children:[e.jsx("input",{ref:U,type:"file",name:"files",accept:"image/*,video/*",multiple:!0,className:"absolute inset-0 z-10 h-full w-full cursor-pointer opacity-0",onChange:s=>{const t=Array.from(s.target.files||[]);t.length>0&&C(t)}}),e.jsxs("div",{className:"pointer-events-none flex flex-col items-center justify-center p-6 text-center",children:[e.jsx(te,{className:`h-10 w-10 mb-2 ${b?"text-red-500":"text-zinc-600"}`}),e.jsx("p",{className:"text-sm font-medium text-white mb-1",children:b?"Suelta los archivos aquí":r.length>0?"Agregar más archivos":"Arrastra y suelta tus archivos aquí"}),e.jsx("p",{className:"text-xs text-zinc-500 mb-2",children:"o haz clic para seleccionar"}),e.jsx("p",{className:"text-xs text-zinc-600",children:"JPG, PNG, GIF, WEBP, MP4, MOV • Máx 15MB por archivo"})]})]}),j&&e.jsxs("p",{className:"flex items-center gap-1 text-xs text-red-400",children:[e.jsx($,{className:"w-3 h-3"}),j]})]}),e.jsx("div",{className:"p-4 rounded-lg border border-zinc-800 bg-zinc-900/50",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(M,{className:"w-5 h-5 text-zinc-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium text-white",children:"Nota de privacidad"}),e.jsxs("p",{className:"text-xs text-zinc-500",children:["Tu denuncia será revisada por nuestros moderadores antes de ser publicada. Solo se mostrarán las denuncias que cumplan con nuestras políticas de contenido.",c&&" Tu identidad permanecerá completamente anónima."]})]})]})}),e.jsxs("div",{className:"flex items-center justify-between pt-2",children:[e.jsx("button",{type:"button",onClick:()=>m("/denuncias"),className:"px-4 py-2 text-sm text-zinc-400 hover:text-white transition",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:h||!d,className:`flex items-center gap-2 px-6 py-3 rounded-lg font-medium transition ${h||!d?"bg-zinc-800 text-zinc-500 cursor-not-allowed":"bg-red-500 hover:bg-red-600 text-white"}`,children:h?e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"h-4 w-4 animate-spin"}),"Enviando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"h-4 w-4"}),"Enviar Denuncia"]})})]})]})}),e.jsxs("div",{className:"mt-8 text-center",children:[e.jsx("p",{className:"text-sm text-zinc-500 italic",children:'"La injusticia en cualquier lugar es una amenaza a la justicia en todas partes"'}),e.jsx("p",{className:"text-xs text-zinc-600 mt-1",children:"- Martin Luther King Jr."})]})]})}):e.jsx("main",{className:"min-h-screen bg-transparent px-4 py-10 md:px-8",children:e.jsxs("div",{className:"mx-auto max-w-2xl",children:[e.jsx(A,{to:"/",label:"Volver al inicio"}),e.jsxs("div",{className:"mt-12 rounded-2xl border border-red-500/20 bg-red-500/10 p-8 text-center",children:[e.jsx(M,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-white mb-3",children:"Acceso Restringido"}),e.jsx("p",{className:"text-zinc-400 mb-6",children:"Debes iniciar sesión para poder enviar una denuncia"}),e.jsx("button",{onClick:()=>m("/login?redirect=/romper"),className:"px-6 py-3 bg-red-500 hover:bg-red-600 text-white font-medium rounded-lg transition",children:"Iniciar Sesión"})]})]})})}export{ue as default};
