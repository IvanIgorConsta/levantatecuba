import{c as _,u as ue,r as o,a as be,j as e,X as O,F as ge,b as je,d as fe,e as Ne,S as B}from"./index-1606e3a6.js";import{p as q}from"./purify.es-ee0e7e34.js";import{B as we}from"./BackLink-10c487b2.js";import{T as k,S as J,H as ve,M as ye}from"./trending-up-e61c2c55.js";import{C as ze,U as K}from"./user-320d65d9.js";import{E as ke}from"./eye-311343d1.js";import{C as _e}from"./chevron-up-b57410b9.js";import{C as Ce}from"./chevron-down-2615923f.js";/**
 * @license lucide-react v0.519.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=[["circle",{cx:"12.1",cy:"12.1",r:"1",key:"18d7e5"}]],Se=_("dot",$e);/**
 * @license lucide-react v0.519.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]],Te=_("link-2",Ee);/**
 * @license lucide-react v0.519.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]],Ae=_("share-2",Le);function De(){const{t:W}=ue(),[m,f]=o.useState([]),[X,C]=o.useState(!0),[G,$]=o.useState({}),[Q,Y]=o.useState({}),[x,N]=o.useState(null),[h,w]=o.useState({}),[S,Z]=o.useState({}),[ee,E]=o.useState(null),[T,v]=o.useState(null),[se,te]=o.useState({}),[ne,L]=o.useState({}),[ae,b]=o.useState({}),y=o.useRef(),d=localStorage.getItem("token"),p=!!d;let re="";try{if(d){const s=be(d);re=(s==null?void 0:s.name)||""}}catch{}o.useEffect(()=>{ie()},[]);const ie=async()=>{C(!0);try{const t=await(await fetch("/api/reports")).json(),n=t.denuncias||t;f(Array.isArray(n)?n:[]);const a={};n.forEach(r=>a[r._id]=r.likes||0),$(a)}catch(s){console.error("Error al cargar denuncias:",s),f([])}finally{C(!1)}};o.useEffect(()=>{const s=t=>{y.current&&!y.current.contains(t.target)&&E(null)};return document.addEventListener("click",s),()=>document.removeEventListener("click",s)},[]);const A=s=>{const t=Math.floor((new Date-new Date(s))/1e3),n={año:31536e3,mes:2592e3,día:86400,hora:3600,minuto:60};for(const[a,r]of Object.entries(n)){const l=Math.floor(t/r);if(l>=1)return`${l} ${a}${l>1?a==="mes"?"es":"s":""}`}return"ahora"},ce=s=>{const n=(s||"").match(/https?:\/\/[^\s<>"']+/i);return n?n[0]:null},oe=(s,t)=>{const n=`${s.slice(0,100)}... ${t}`.trim();return/Android|iPhone|iPad|iPod|Opera Mini|IEMobile/i.test(navigator.userAgent)?{wa:`whatsapp://send?text=${encodeURIComponent(n)}`,tw:`twitter://post?message=${encodeURIComponent(n)}`,fb:`fb://facewebmodal/f?href=${encodeURIComponent(t)}`}:{wa:`https://wa.me/?text=${encodeURIComponent(n)}`,tw:`https://twitter.com/intent/tweet?text=${encodeURIComponent(s.slice(0,100))}&url=${encodeURIComponent(t)}`,fb:`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(t)}`}},le=async s=>{try{const n=await(await fetch(`/api/reports/${s}/comentarios`)).json();f(a=>a.map(r=>r._id===s?{...r,comentarios:n}:r))}catch(t){console.error("Error al actualizar comentarios:",t)}},de=async s=>{try{const t=await fetch(`/api/reports/${s}/like`,{method:"POST",headers:{"Content-Type":"application/json",...d&&{Authorization:`Bearer ${d}`}}});if(!t.ok)throw new Error("Error al dar like");const{likes:n}=await t.json();$(a=>({...a,[s]:n})),L(a=>({...a,[s]:!0})),setTimeout(()=>L(a=>({...a,[s]:!1})),250)}catch(t){console.error("❌ Error al actualizar like:",t)}},z=async(s,t=null)=>{var r;if(!d){alert("⚠ Debes iniciar sesión para comentar.");return}const n=(x==null?void 0:x.id)||s;if(!((r=h[n])!=null&&r.trim()))return;let a=`/api/reports/${s}/comentarios`;t&&(a=`/api/reports/${s}/comentarios/${t}/responder`);try{(await fetch(a,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${d}`},body:JSON.stringify({mensaje:h[n]})})).ok&&(await le(s),w(c=>({...c,[n]:""})),N(null),b(c=>({...c,[s]:!0})),setTimeout(()=>b(c=>({...c,[s]:!1})),250))}catch(l){console.error("Error al enviar comentario:",l)}},me=()=>N(null),xe=async s=>{try{if(!navigator.clipboard){alert("⚠ Tu navegador no permite copiar automáticamente.");return}await navigator.clipboard.writeText(`${s.slice(0,100)}...
${window.location.href}`),alert("✅ Enlace copiado al portapapeles")}catch(t){console.error("Error al copiar enlace:",t),alert("⚠ No se pudo copiar el enlace.")}},he=s=>{te(t=>({...t,[s]:!t[s]}))},pe=({url:s})=>{if(!s)return null;try{const t=new URL(s),n=t.hostname.replace(/^www\./,""),a=`https://www.google.com/s2/favicons?domain=${t.hostname}&sz=64`;return e.jsx("a",{href:s,target:"_blank",rel:"noopener noreferrer",className:"mt-3 block rounded-lg border border-zinc-800 bg-zinc-900/50 p-3 hover:bg-zinc-900 transition",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:a,alt:"",className:"w-5 h-5 rounded"}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"text-sm font-medium text-zinc-100 truncate flex items-center gap-2",children:[e.jsx(Te,{className:"w-4 h-4 opacity-70"}),n]}),e.jsx("div",{className:"text-xs text-zinc-500 truncate",children:s})]})]})})}catch{return null}},R=({comentario:s,denunciaId:t,nivel:n=0})=>{var r,l;const a=(x==null?void 0:x.id)===s._id;return e.jsx("div",{className:`${n>0?"ml-12 mt-2":"mt-3"}`,children:e.jsx("div",{className:`group ${n===0?"border-l-2 border-zinc-800 pl-4":""}`,children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${n===0?"bg-zinc-800":"bg-zinc-900"}`,children:e.jsx(K,{className:"w-4 h-4 text-zinc-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-medium text-white text-sm",children:s.usuario||"Anónimo"}),e.jsxs("span",{className:"text-xs text-zinc-500",children:["· ",A(s.fecha)]})]}),e.jsx("p",{className:"text-sm text-zinc-300 break-words",dangerouslySetInnerHTML:{__html:q.sanitize(s.mensaje)}}),e.jsxs("div",{className:"flex items-center gap-4 mt-2",children:[p&&e.jsx("button",{onClick:()=>N({id:s._id,denunciaId:t}),className:"text-xs text-zinc-500 hover:text-blue-400 transition",children:"Responder"}),((r=s.respuestas)==null?void 0:r.length)>0&&e.jsx("button",{onClick:()=>Z(c=>({...c,[s._id]:!c[s._id]})),className:"text-xs text-zinc-500 hover:text-white transition flex items-center gap-1",children:S[s._id]?e.jsxs(e.Fragment,{children:[e.jsx(_e,{className:"w-3 h-3"}),"Ocultar"]}):e.jsxs(e.Fragment,{children:[e.jsx(Ce,{className:"w-3 h-3"}),s.respuestas.length," respuesta",s.respuestas.length>1?"s":""]})})]}),a&&e.jsxs("div",{className:"mt-3 flex gap-2",children:[e.jsx("input",{type:"text",placeholder:`Responder a ${s.usuario||"Anónimo"}...`,value:h[s._id]||"",onChange:c=>w(j=>({...j,[s._id]:c.target.value})),className:"flex-1 px-3 py-2 bg-zinc-900 border border-zinc-800 rounded-lg text-sm text-white placeholder-zinc-500 focus:border-red-500 focus:outline-none",autoFocus:!0}),e.jsx("button",{onClick:()=>z(t,s._id),className:"p-2 bg-red-500 hover:bg-red-600 text-white rounded-lg transition",children:e.jsx(B,{className:"w-4 h-4"})}),e.jsx("button",{onClick:me,className:"p-2 bg-zinc-800 hover:bg-zinc-700 text-white rounded-lg transition",children:e.jsx(O,{className:"w-4 h-4"})})]}),S[s._id]&&((l=s.respuestas)==null?void 0:l.map(c=>e.jsx(R,{comentario:c,denunciaId:t,nivel:n+1},c._id)))]})]})})})},U=(s,t=!1)=>{var M,F,P,V,H,D;const n=typeof window<"u"?window.location.href:"",a=oe(s.contenido,n),r=ce(s.contenido),l=se[s._id],c=280,j=(s.contenido||"").length>c;return e.jsx("article",{className:`border rounded-xl transition-all hover:border-zinc-700 ${t?"border-purple-500/30 bg-purple-500/5":"border-zinc-800 bg-black"}`,children:e.jsx("div",{className:"px-4 pt-4 pb-3",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center font-bold text-lg flex-shrink-0 ${t?"bg-purple-500 text-black":"bg-red-500 text-white"}`,children:((M=s.nombre)==null?void 0:M.charAt(0).toUpperCase())||"A"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-bold text-white",children:s.nombre||"Anónimo"}),t&&e.jsx(J,{className:"w-4 h-4 text-purple-400 fill-purple-400"}),e.jsx(Se,{className:"w-3 h-3 text-zinc-500"}),e.jsx("span",{className:"text-sm text-zinc-500",children:A(s.createdAt)})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-[15px] leading-relaxed text-white whitespace-pre-wrap break-words",dangerouslySetInnerHTML:{__html:q.sanitize(l||!j?s.contenido:`${s.contenido.slice(0,c)}...`)}}),j&&e.jsx("button",{onClick:()=>he(s._id),className:"mt-1 text-sm text-blue-400 hover:text-blue-300 transition",children:l?"Ver menos":"Ver más"})]}),r&&e.jsx(pe,{url:r}),s.media&&e.jsx("div",{className:"mt-3 rounded-xl overflow-hidden border border-zinc-800",children:/\.(mp4|mov|webm)$/i.test(s.media)?e.jsx("video",{src:s.media,controls:!0,className:"w-full max-h-96"}):e.jsx("img",{src:s.media,alt:"Evidencia",className:"w-full max-h-96 object-cover cursor-pointer hover:opacity-90 transition",onClick:()=>v(s.media)})}),e.jsxs("div",{className:"mt-4 flex items-center justify-between border-t border-zinc-800 pt-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("button",{onClick:()=>de(s._id),className:`flex items-center gap-2 px-3 py-2 rounded-lg transition hover:bg-zinc-900 ${ne[s._id]?"scale-110":"scale-100"}`,children:[e.jsx(ve,{className:"w-5 h-5 text-zinc-500 hover:text-red-500 transition"}),e.jsx("span",{className:"text-sm text-zinc-400",children:G[s._id]||0})]}),e.jsxs("button",{onClick:()=>{Y(i=>({...i,[s._id]:!i[s._id]})),b(i=>({...i,[s._id]:!0})),setTimeout(()=>b(i=>({...i,[s._id]:!1})),250)},className:`flex items-center gap-2 px-3 py-2 rounded-lg transition hover:bg-zinc-900 ${ae[s._id]?"scale-105":"scale-100"}`,children:[e.jsx(ye,{className:"w-5 h-5 text-zinc-500 hover:text-blue-500 transition"}),e.jsx("span",{className:"text-sm text-zinc-400",children:((F=s.comentarios)==null?void 0:F.length)||0})]}),e.jsx("button",{onClick:i=>{i.stopPropagation(),E(u=>u===s._id?null:s._id)},className:"flex items-center gap-2 px-3 py-2 rounded-lg transition hover:bg-zinc-900",children:e.jsx(Ae,{className:"w-5 h-5 text-zinc-500 hover:text-green-500 transition"})})]}),((P=s.comentarios)==null?void 0:P.length)>0&&e.jsxs("span",{className:"text-xs text-zinc-500",children:[e.jsx(ke,{className:"w-4 h-4 inline mr-1"}),s.likes+(((V=s.comentarios)==null?void 0:V.length)||0)*2," interacciones"]})]}),ee===s._id&&e.jsxs("div",{ref:y,className:"mt-2 p-3 bg-zinc-900 border border-zinc-800 rounded-lg flex items-center gap-3",onClick:i=>i.stopPropagation(),children:[e.jsx("a",{href:a.wa,target:"_blank",rel:"noopener noreferrer",className:"p-2 bg-green-600/20 hover:bg-green-600/30 rounded-lg transition",children:e.jsx(ge,{className:"w-5 h-5 text-green-400"})}),e.jsx("a",{href:a.tw,target:"_blank",rel:"noopener noreferrer",className:"p-2 bg-blue-600/20 hover:bg-blue-600/30 rounded-lg transition",children:e.jsx(je,{className:"w-5 h-5 text-blue-400"})}),e.jsx("a",{href:a.fb,target:"_blank",rel:"noopener noreferrer",className:"p-2 bg-blue-700/20 hover:bg-blue-700/30 rounded-lg transition",children:e.jsx(fe,{className:"w-5 h-5 text-blue-500"})}),e.jsx("button",{onClick:()=>xe(s.contenido),className:"p-2 bg-zinc-800 hover:bg-zinc-700 rounded-lg transition",children:e.jsx(Ne,{className:"w-5 h-5 text-zinc-400"})})]}),Q[s._id]&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-zinc-800",children:[p&&e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-zinc-800 flex items-center justify-center flex-shrink-0",children:e.jsx(K,{className:"w-4 h-4 text-zinc-400"})}),e.jsx("input",{type:"text",placeholder:"Escribe un comentario...",value:h[s._id]||"",onChange:i=>w(u=>({...u,[s._id]:i.target.value})),onKeyPress:i=>{var u;i.key==="Enter"&&((u=h[s._id])!=null&&u.trim())&&z(s._id)},className:"flex-1 px-3 py-2 bg-zinc-900 border border-zinc-800 rounded-lg text-sm text-white placeholder-zinc-500 focus:border-red-500 focus:outline-none"}),e.jsx("button",{onClick:()=>z(s._id),disabled:!((H=h[s._id])!=null&&H.trim()),className:"p-2 bg-red-500 hover:bg-red-600 disabled:bg-zinc-800 disabled:cursor-not-allowed text-white rounded-lg transition",children:e.jsx(B,{className:"w-4 h-4"})})]}),((D=s.comentarios)==null?void 0:D.length)>0?e.jsx("div",{className:"space-y-3",children:s.comentarios.map(i=>e.jsx(R,{comentario:i,denunciaId:s._id},i._id))}):e.jsx("p",{className:"text-center text-sm text-zinc-500 py-4",children:p?"Sé el primero en comentar":"Inicia sesión para comentar"})]})]})]})})},s._id)},g=m.filter(s=>s.destacada),I=m.filter(s=>!s.destacada);return X?e.jsx("main",{className:"min-h-screen bg-transparent py-8 px-4",children:e.jsx("div",{className:"max-w-3xl mx-auto",children:e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-red-500"})})})}):e.jsxs("main",{className:"min-h-screen bg-transparent py-8 px-4",children:[e.jsxs("div",{className:"max-w-3xl mx-auto",children:[e.jsx(we,{to:"/",label:"Volver al inicio"}),e.jsxs("div",{className:"flex items-center justify-between mb-6 mt-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Denuncias Ciudadanas"}),e.jsx("p",{className:"text-sm text-zinc-500 mt-1",children:"Voces que exigen justicia y cambio"})]}),e.jsxs("a",{href:p?"/romper":"/login?redirect=/romper",className:"flex items-center gap-2 px-4 py-2 bg-red-500 hover:bg-red-600 text-white font-medium rounded-lg transition",children:[e.jsx(k,{className:"w-4 h-4"}),"Hacer denuncia"]})]}),m.length>0&&e.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-6",children:[e.jsxs("div",{className:"bg-zinc-900 border border-zinc-800 rounded-lg p-3 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-white",children:m.length}),e.jsx("p",{className:"text-xs text-zinc-500",children:"Total denuncias"})]}),e.jsxs("div",{className:"bg-zinc-900 border border-zinc-800 rounded-lg p-3 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-white",children:g.length}),e.jsx("p",{className:"text-xs text-zinc-500",children:"Destacadas"})]}),e.jsxs("div",{className:"bg-zinc-900 border border-zinc-800 rounded-lg p-3 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-white",children:m.reduce((s,t)=>{var n;return s+(((n=t.comentarios)==null?void 0:n.length)||0)},0)}),e.jsx("p",{className:"text-xs text-zinc-500",children:"Comentarios"})]})]}),m.length===0?e.jsxs("div",{className:"text-center py-12 bg-zinc-900/50 border border-zinc-800 rounded-xl",children:[e.jsx(ze,{className:"w-12 h-12 text-zinc-600 mx-auto mb-4"}),e.jsx("p",{className:"text-zinc-400 text-lg font-medium",children:W("general.no_data","Aún no hay denuncias aprobadas")}),e.jsx("p",{className:"text-sm text-zinc-500 mt-2 mb-6",children:"Sé el primero en alzar tu voz contra la injusticia"}),e.jsxs("a",{href:p?"/romper":"/login?redirect=/romper",className:"inline-flex items-center gap-2 px-6 py-3 bg-red-500 hover:bg-red-600 text-white font-medium rounded-lg transition",children:[e.jsx(k,{className:"w-4 h-4"}),"Hacer la primera denuncia"]})]}):e.jsxs("div",{className:"space-y-4",children:[g.length>0&&e.jsxs("section",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(J,{className:"w-5 h-5 text-purple-400 fill-purple-400"}),e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Denuncias Destacadas"})]}),e.jsx("div",{className:"space-y-3",children:g.map(s=>U(s,!0))})]}),I.length>0&&e.jsxs("section",{children:[g.length>0&&e.jsx("h2",{className:"text-lg font-semibold text-white mb-3",children:"Más denuncias"}),e.jsx("div",{className:"space-y-3",children:I.map(s=>U(s,!1))})]}),e.jsxs("div",{className:"mt-8 text-center py-8 bg-zinc-900/50 border border-zinc-800 rounded-xl",children:[e.jsx("p",{className:"text-zinc-400 mb-4",children:"¿Tienes algo que reportar? Tu aporte ayuda a visibilizar problemas reales."}),e.jsxs("a",{href:p?"/romper":"/login?redirect=/romper",className:"inline-flex items-center gap-2 px-6 py-3 bg-red-500 hover:bg-red-600 text-white font-medium rounded-lg transition",children:[e.jsx(k,{className:"w-4 h-4"}),"Hacer denuncia"]})]})]})]}),T&&e.jsxs("div",{className:"fixed inset-0 bg-black/90 z-50 flex items-center justify-center p-4",onClick:()=>v(null),children:[e.jsx("button",{className:"absolute top-4 right-4 text-white hover:text-red-400 transition",onClick:()=>v(null),children:e.jsx(O,{className:"w-6 h-6"})}),e.jsx("img",{src:T,alt:"Vista ampliada",className:"max-w-full max-h-full object-contain",onClick:s=>s.stopPropagation()})]})]})}export{De as default};
